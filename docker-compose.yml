services:
  # Backend container - Pipeline için aktif, lokal development için yorum satırında
  # Lokal development: Backend'i manuel olarak çalıştırın: mvn spring-boot:run
  # Pipeline: Jenkinsfile'da backend container'ı build edilip başlatılır
  banking-app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: banking-app
    environment:
      SPRING_DATASOURCE_URL: jdbc:sqlite:/app/data/banking.db
      SERVER_PORT: 8080  # Container içinde 8080, host'ta 8081:8080 mapping
    ports:
      - "8081:8080"  # Pipeline için kullanılır
    volumes:
      - banking_data:/app/data
    restart: unless-stopped
    # Lokal development için yorum satırına alın (backend'i manuel çalıştırın)
    # profiles:
    #   - pipeline

  frontend:
    image: nginx:alpine
    container_name: banking-frontend
    ports:
      - "8082:80"
    volumes:
      - ./frontend:/usr/share/nginx/html:ro
      - ./frontend/nginx.conf:/etc/nginx/conf.d/default.conf:ro
    # Lokal development için: depends_on'u yorum satırına alın
    # Pipeline için: depends_on aktif kalmalı
    depends_on:
      - banking-app
    restart: unless-stopped
    # Lokal development için: extra_hosts ekleyin
    extra_hosts:
      - "host.docker.internal:host-gateway"

volumes:
  banking_data:

